<!--
  ~ Licensed to the Apache Software Foundation (ASF) under one or more
  ~ contributor license agreements.  See the NOTICE file distributed with
  ~ this work for additional information regarding copyright ownership.
  ~ The ASF licenses this file to You under the Apache License, Version 2.0
  ~ (the "License"); you may not use this file except in compliance with
  ~ the License.  You may obtain a copy of the License at
  ~
  ~    http://www.apache.org/licenses/LICENSE-2.0
  ~
  ~ Unless required by applicable law or agreed to in writing, software
  ~ distributed under the License is distributed on an "AS IS" BASIS,
  ~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  ~ See the License for the specific language governing permissions and
  ~ limitations under the License.
  ~
  -->

<div fxFlex="100" fxLayout="column" style="margin-top:40px;">
    <div fxFlex="100" fxLayout="row wrap" fxLayoutAlign="start stretch">
        <div fxFlex="100" class="assemblyOptions sp-blue-bg" style="padding:5px;">
            <div fxLayout="row" fxLayoutAlign="start center" fxFlex="100">
                <h4>Node Overview</h4>
                <span flex></span>
            </div>
        </div>
        <div fxFlex="100" fxLayoutAlign="start start" class="sp-blue-border page-container-padding-inner">
            <div fxLayoutAlign="center right">
                <button class="md-raised md-primary submit-button"
                        mat-fab color="accent"
                        type="submit"
                        matTooltip="add new node"
                        (click)="addNode()">
                    <mat-icon>add</mat-icon>
                </button>
            </div>
            <mat-grid-list
                    [cols]="3" [rowHeight]="300"
                    [gutterSize]="10" fxFlex="100">

                <mat-grid-tile class="gray" *ngFor="let node of nodes">
                    <mat-card class="node-card">
                        <mat-card-header class="header">
                            <div class="div-menu">
                                <button mat-icon-button [matMenuTriggerFor]="menu" aria-label="node menu">
                                    <mat-icon>more_vert</mat-icon>
                                </button>
                                <mat-menu #menu="matMenu" style="font-size: 10pt">
                                    <button mat-menu-item
                                            *ngIf="!node.active"
                                            [disabled]="node.condition === 'OFFLINE' || node.condition === 'CONNECTING'"
                                            (click)="changeNodeState(node, true)">
                                        <mat-icon
                                                [ngClass]="node.active ? 'node-activated' : 'node-inactive'"
                                                matTooltip="{{node.active ? 'node alive and running' : 'activate node'}}"
                                                matTooltipPosition="above">
                                            play_circle_filled
                                        </mat-icon>
                                        <span>activate</span>
                                    </button>
                                    <button mat-menu-item
                                            *ngIf="node.active"
                                            [disabled]="node.condition === 'OFFLINE' || node.condition === 'CONNECTING'"
                                            (click)="changeNodeState(node, false)">
                                        <mat-icon
                                                [ngClass]="node.active ? 'node-inactive' : 'node-deactivated'"
                                                matTooltip="{{!node.active ? 'node deactivated' : 'deactivate node'}}"
                                                matTooltipPosition="above">
                                            pause_circle_filled
                                        </mat-icon>
                                        <span>deactivate</span>
                                    </button>
<!--                                    <button mat-menu-item-->
<!--                                            [disabled]="node.active"-->
<!--                                            matTooltip="{{!node.active ? 'evict processors' :-->
<!--                                            'evict processors option not available'}}"-->
<!--                                            (click)="evict(node)">-->
<!--                                        <mat-icon-->
<!--                                                [ngClass]="node.active ? 'node-inactive' : 'node-evict'"-->
<!--                                                matTooltipPosition="above">-->
<!--                                            swap_horizontal_circle_filled-->
<!--                                        </mat-icon>-->
<!--                                        <span>evict</span>-->
<!--                                    </button>-->
                                    <button mat-menu-item
                                            [disabled]="!node.active || node.condition === 'OFFLINE'"
                                            matTooltip="Edit node configuration"
                                            matTooltipPosition="above"
                                            (click)="settings(node)">
                                        <mat-icon
                                                [ngClass]="'node-inactive'">
                                            sell
                                        </mat-icon>
                                        <span>edit</span>
                                    </button>
<!--                                    <button mat-menu-item-->
<!--                                            [disabled]="!node.active || node.condition === 'OFFLINE'"-->
<!--                                            matTooltip="Edit node connectivity"-->
<!--                                            matTooltipPosition="above"-->
<!--                                            (click)="settings(node)">-->
<!--                                        <mat-icon-->
<!--                                                [ngClass]="'node-inactive'">-->
<!--                                            contactless-->
<!--                                        </mat-icon>-->
<!--                                        <span>connectivity</span>-->
<!--                                    </button>-->
                                </mat-menu>
                            </div>
                            <div mat-card-avatar class="node-header-avatar">
                                <button mat-icon-button class="node-mat-icon-button" disabled>
                                    <mat-icon [ngClass]="'node-inactive'">
                                        storage
<!--                                        {{node.staticNodeMetadata.type == 'cloud' ? 'cloud' :-->
<!--                                        node.staticNodeMetadata.type == 'fog' ? 'storage' : 'developer_board'}}-->
                                    </mat-icon>
                                </button>
                            </div>
                            <mat-card-title
                                    style="font-size: 12pt">{{node.hostname}} |
                                {{node.staticNodeMetadata.type}}</mat-card-title>
                            <mat-card-subtitle style="font-size: 10pt">
                                {{node.nodeControllerId}} | <b>{{node.nodeResources.softwareResource.os}}</b>
                                <div style="color: lightgrey;">
                                    last contact: {{this.toHumanReadableDate(node.lastHeartBeatTime)}}
                                    <span *ngIf="node.condition === 'CONNECTING' && node.active"
                                          class="span-node-active">
                                        connecting</span>
                                    <span *ngIf="node.condition === 'ONLINE' && node.active" class="span-node-active">
                                        online</span>
                                    <span *ngIf="node.condition === 'ONLINE' && !node.active"
                                          class="span-node-inactive">
                                        deactivated</span>
                                    <span *ngIf="node.condition === 'OFFLINE' && node.active"
                                          class="span-node-inactive">offline
                                    </span>
                                    <span *ngIf="node.condition === 'OFFLINE' && !node.active"
                                          class="span-node-inactive">lost
                                    </span>
                                </div>
                            </mat-card-subtitle>
                        </mat-card-header>
                        <mat-card-content>
                            <div class="div-node-tag" *ngFor="let tag of node.staticNodeMetadata.locationTags">
                                <span class="span-node-tag">{{tag}}</span>&nbsp;
                            </div>
                            <div class="div-sa-tag" *ngFor="let device of node.nodeResources.fieldDeviceAccessResourceList">
                                <span class="span-sa-tag">{{device.deviceName}}</span>&nbsp;
                            </div>
                            <hr/>
                            <div>
                                <ul class="ft-foot">
                                    <li><span class="inclusion" style="color: darkgray"><i
                                            class="fas fa-microchip"></i></span><b>{{node.nodeResources.hardwareResource.cpu.cores}}</b> cores
                                    </li>
                                    <li><span class="inclusion"
                                              style="color: darkgray"><i class="fas fa-memory"></i></span><b>{{this.bytesToGB(node.nodeResources.hardwareResource.memory.memTotal)}}</b> GiB</li>
                                    <li><span class="inclusion"
                                              style="color: darkgray"><i class="fas fa-hdd"></i></span><b>{{this.bytesToGB(node.nodeResources.hardwareResource.disk.diskTotal)}}</b>
                                        GiB</li>
                                </ul>
                                <ul class="ft-foot">
                                    <li><span class="inclusion"
                                              style="color: darkgray"><i class="fas fa-cube"></i></span>{{node.nodeResources.hardwareResource.cpu.arch}}</li>
                                    <li><span class="inclusion"
                                              style="color: darkgray"><i class="fab fa-docker"></i></span>{{node.nodeResources.softwareResource.containerRuntime.serverVersion}}</li>
                                    <li><span class="inclusion"
                                              style="color: darkgray"><i class="fas fa-meteor"></i></span>GPU
                                        <b>{{nvidiaRuntime(node)}}</b></li>
                                </ul>
                            </div>
<!--                            <div *ngFor="let container of node.registeredContainers">-->
<!--                                <span>{{container.containerName}}</span>-->
<!--                            </div>-->
                        </mat-card-content>
                        <mat-card-actions>
<!--                            <mat-divider></mat-divider>-->
<!--                            <div style="margin-top: 1em" fxLayout="row"-->
<!--                                 fxLayoutAlign="start center" fxFlex="100">-->
<!--                                <div style="margin: auto; border: 1px solid  rgb(57, 181, 74); color: rgb(57, 181, 74)">-->
<!--                                    <button mat-button>-->
<!--                                        <mat-icon>add_circle_outline</mat-icon>-->
<!--                                        add container-->
<!--                                    </button>-->
<!--                                </div>-->
<!--                            </div>-->
                        </mat-card-actions>
                    </mat-card>
                </mat-grid-tile>
            </mat-grid-list>
        </div>
    </div>
</div>